<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slot Game - Simple HTTP API Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .game-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 600px;
            width: 100%;
        }
        
        .game-title {
            color: #333;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .status-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #007bff;
        }
        
        .balance-display {
            font-size: 1.5em;
            color: #28a745;
            font-weight: bold;
            margin: 15px 0;
        }
        
        .connection-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .connection-status.connected {
            background-color: #d4edda;
            color: #155724;
        }
        
        .connection-status.connecting {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .connection-status.disconnected {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .reels-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 3px solid #007bff;
        }
        
        .reel {
            width: 80px;
            height: 100px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            transition: all 0.3s ease;
        }
        
        .reel.spinning {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }
        
        .controls {
            margin: 20px 0;
        }
        
        .bet-selector {
            margin: 15px 0;
        }
        
        .bet-selector label {
            font-weight: bold;
            color: #333;
            margin-right: 10px;
        }
        
        .bet-selector select {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 5px;
            font-size: 16px;
            background: white;
        }
        
        .spin-button {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 15px;
        }
        
        .spin-button:hover:not(:disabled) {
            background: linear-gradient(135deg, #218838, #1ea085);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .spin-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        .result-display {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .result-display.result-win {
            background-color: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }
        
        .result-display.result-lose {
            background-color: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }
        
        .result-display.loading {
            background-color: #fff3cd;
            color: #856404;
            border: 2px solid #ffc107;
        }
        
        .test-buttons {
            margin: 20px 0;
        }
        
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .test-button:hover {
            background: #0056b3;
        }
        
        .api-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            text-align: left;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 class="game-title">ğŸ° è€è™æ©ŸéŠæˆ² (HTTP API æ¸¬è©¦)</h1>
        
        <div class="status-info">
            <div class="connection-status disconnected" id="connectionStatus">æœªé€£æ¥</div>
            <div id="gameStatus">é»æ“Šä¸‹æ–¹æŒ‰éˆ•æ¸¬è©¦ API</div>
            <div class="balance-display">é¤˜é¡: $<span id="balance">1000.00</span></div>
        </div>
        
        <div class="test-buttons">
            <button class="test-button" onclick="testAuthenticate()">æ¸¬è©¦èªè­‰ API</button>
            <button class="test-button" onclick="testInfo()">æ¸¬è©¦è³‡è¨Š API</button>
            <button class="test-button" onclick="testPlay()">æ¸¬è©¦éŠæˆ² API</button>
            <button class="test-button" onclick="clearLog()">æ¸…é™¤æ—¥èªŒ</button>
        </div>
        
        <div class="api-log" id="apiLog">
            ç­‰å¾… API æ¸¬è©¦...
        </div>
        
        <div class="reels-container">
            <div class="reel" id="reel1">ğŸ</div>
            <div class="reel" id="reel2">ğŸŠ</div>
            <div class="reel" id="reel3">ğŸ‡</div>
        </div>
        
        <div class="controls">
            <div class="bet-selector">
                <label for="betAmount">é¸æ“‡ä¸‹æ³¨é‡‘é¡:</label>
                <select id="betAmount">
                    <option value="1">$1</option>
                    <option value="2">$2</option>
                    <option value="5" selected>$5</option>
                    <option value="10">$10</option>
                    <option value="20">$20</option>
                    <option value="50">$50</option>
                    <option value="100">$100</option>
                    <option value="200">$200</option>
                </select>
            </div>
            
            <button class="spin-button" id="spinButton" onclick="simulateSpin()">
                æ¨¡æ“¬æ—‹è½‰ (æ¸¬è©¦ç”¨)
            </button>
        </div>
        
        <div class="result-display" id="resultDisplay">
            æ­¡è¿ä¾†åˆ°è€è™æ©ŸéŠæˆ² API æ¸¬è©¦é é¢ï¼
        </div>
    </div>

    <script>
        const symbolMap = {
            'SYM1': 'ğŸ€',
            'SYM2': 'ğŸ',
            'SYM3': 'ğŸŠ', 
            'SYM4': 'ğŸ‡',
            'SYM5': 'ğŸ“',
            'SYM6': 'ğŸ¥'
        };
        
        function log(message) {
            const apiLog = document.getElementById('apiLog');
            const timestamp = new Date().toLocaleTimeString();
            apiLog.innerHTML += `[${timestamp}] ${message}\n`;
            apiLog.scrollTop = apiLog.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('apiLog').innerHTML = '';
        }
        
        async function makeHTTPRequest(endpoint, data) {
            try {
                log(`ç™¼é€è«‹æ±‚åˆ°: ${endpoint}`);
                log(`è«‹æ±‚è³‡æ–™: ${JSON.stringify(data, null, 2)}`);
                
                const response = await fetch(`http://localhost:8080/slot-game-provider/slot-game${endpoint}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                log(`å›æ‡‰ç‹€æ…‹: ${response.status} ${response.statusText}`);
                
                const responseText = await response.text();
                log(`åŸå§‹å›æ‡‰: ${responseText}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const jsonData = JSON.parse(responseText);
                log(`è§£æå¾Œçš„ JSON: ${JSON.stringify(jsonData, null, 2)}`);
                
                return jsonData;
                
            } catch (error) {
                log(`éŒ¯èª¤: ${error.message}`);
                throw error;
            }
        }
        
        async function testAuthenticate() {
            try {
                document.getElementById('connectionStatus').textContent = 'æ¸¬è©¦ä¸­...';
                document.getElementById('connectionStatus').className = 'connection-status connecting';
                
                const result = await makeHTTPRequest('/authenticate', {
                    operator: "demo",
                    wallet: "demo",
                    key: "test-player-123:1000:eur"
                });
                
                document.getElementById('connectionStatus').textContent = 'èªè­‰æˆåŠŸ';
                document.getElementById('connectionStatus').className = 'connection-status connected';
                log('âœ… èªè­‰æ¸¬è©¦æˆåŠŸï¼');
                
            } catch (error) {
                document.getElementById('connectionStatus').textContent = 'èªè­‰å¤±æ•—';
                document.getElementById('connectionStatus').className = 'connection-status disconnected';
                log(`âŒ èªè­‰æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }
        
        async function testInfo() {
            try {
                const result = await makeHTTPRequest('/info', {
                    sessionId: 'test-session'
                });
                log('âœ… è³‡è¨Š API æ¸¬è©¦æˆåŠŸï¼');
            } catch (error) {
                log(`âŒ è³‡è¨Š API æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }
        
        async function testPlay() {
            try {
                const betAmount = parseInt(document.getElementById('betAmount').value);
                const result = await makeHTTPRequest('/play', {
                    sessionId: 'test-session',
                    action: "main",
                    bet: betAmount
                });
                log('âœ… éŠæˆ² API æ¸¬è©¦æˆåŠŸï¼');
                
                // å¦‚æœæœ‰éŠæˆ²çµæœï¼Œé¡¯ç¤ºç¬¦è™Ÿ
                if (result.data && result.data.symbols) {
                    displaySymbols(result.data.symbols);
                } else if (result.symbols) {
                    displaySymbols(result.symbols);
                }
                
            } catch (error) {
                log(`âŒ éŠæˆ² API æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }
        
        function displaySymbols(symbols) {
            document.getElementById('reel1').textContent = symbolMap[symbols[0]] || symbols[0];
            document.getElementById('reel2').textContent = symbolMap[symbols[1]] || symbols[1];
            document.getElementById('reel3').textContent = symbolMap[symbols[2]] || symbols[2];
        }
        
        function simulateSpin() {
            const reels = ['reel1', 'reel2', 'reel3'];
            const symbols = Object.values(symbolMap);
            
            // æ·»åŠ æ—‹è½‰å‹•ç•«
            reels.forEach(reelId => {
                document.getElementById(reelId).classList.add('spinning');
            });
            
            // 1ç§’å¾Œåœæ­¢ä¸¦é¡¯ç¤ºéš¨æ©Ÿç¬¦è™Ÿ
            setTimeout(() => {
                reels.forEach(reelId => {
                    const randomSymbol = symbols[Math.floor(Math.random() * symbols.length)];
                    const reel = document.getElementById(reelId);
                    reel.textContent = randomSymbol;
                    reel.classList.remove('spinning');
                });
                
                document.getElementById('resultDisplay').textContent = 'æ¨¡æ“¬æ—‹è½‰å®Œæˆï¼';
            }, 1000);
        }
        
        // é é¢è¼‰å…¥å®Œæˆ
        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸ® é é¢è¼‰å…¥å®Œæˆï¼Œå¯ä»¥é–‹å§‹æ¸¬è©¦ APIï¼');
            document.getElementById('gameStatus').textContent = 'é é¢å·²è¼‰å…¥ï¼Œå¯ä»¥æ¸¬è©¦ API';
        });
    </script>
</body>
</html>
