<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slot Game - Simple HTTP API Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .game-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 600px;
            width: 100%;
        }
        
        .game-title {
            color: #333;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .status-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #007bff;
        }
        
        .balance-display {
            font-size: 1.5em;
            color: #28a745;
            font-weight: bold;
            margin: 15px 0;
        }

        .balance-display.hidden {
            display: none;
        }

        .login-prompt {
            font-size: 1.2em;
            color: #dc3545;
            font-weight: bold;
            margin: 15px 0;
            padding: 10px;
            background-color: #f8d7da;
            border-radius: 8px;
            border: 2px dashed #721c24;
        }

        .login-prompt.hidden {
            display: none;
        }
        
        .connection-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .connection-status.connected {
            background-color: #d4edda;
            color: #155724;
        }
        
        .connection-status.connecting {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .connection-status.disconnected {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .reels-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 3px solid #007bff;
        }
        
        .reel {
            width: 80px;
            height: 100px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            transition: all 0.3s ease;
        }
        
        .reel.spinning {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }
        
        .controls {
            margin: 20px 0;
        }
        
        .bet-selector {
            margin: 15px 0;
        }
        
        .bet-selector label {
            font-weight: bold;
            color: #333;
            margin-right: 10px;
        }
        
        .bet-selector select {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 5px;
            font-size: 16px;
            background: white;
        }
        
        .spin-button {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 15px;
        }
        
        .spin-button:hover:not(:disabled) {
            background: linear-gradient(135deg, #218838, #1ea085);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .spin-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        .result-display {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .result-display.result-win {
            background-color: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }
        
        .result-display.result-lose {
            background-color: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }
        
        .result-display.loading {
            background-color: #fff3cd;
            color: #856404;
            border: 2px solid #ffc107;
        }
        
        .test-buttons {
            margin: 20px 0;
        }
        
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .test-button:hover {
            background: #0056b3;
        }
        
        .api-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            text-align: left;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 class="game-title">ğŸ° è€è™æ©ŸéŠæˆ² (HTTP API æ¸¬è©¦)</h1>
        
        <div class="status-info">
            <div class="connection-status disconnected" id="connectionStatus">âŒ æœªç™»å…¥</div>
            <div id="gameStatus">é»æ“Šä¸‹æ–¹æŒ‰éˆ•æ¸¬è©¦ API</div>
            <div class="login-prompt" id="loginPrompt">ğŸ” è«‹å…ˆé»æ“Šã€Œæ¸¬è©¦èªè­‰ã€æŒ‰éˆ•é€²è¡Œç™»å…¥</div>
            <div class="balance-display hidden" id="balanceDisplay">é¤˜é¡: $<span id="balance">0.00</span></div>
        </div>
        
        <div class="test-buttons">
            <button class="test-button" onclick="testGames()">æ¸¬è©¦éŠæˆ²åˆ—è¡¨</button>
            <button class="test-button" onclick="testAuthenticate()">æ¸¬è©¦èªè­‰</button>
            <button class="test-button" onclick="testConfig()">æ¸¬è©¦é…ç½®</button>
            <button class="test-button" onclick="testBets()">æ¸¬è©¦ä¸‹æ³¨</button>
            <button class="test-button" onclick="testInfo()">æ¸¬è©¦è³‡è¨Š</button>
            <button class="test-button" onclick="testCheats()">æ¸¬è©¦ä½œå¼Š</button>
            <button class="test-button" onclick="testPlay()">æ¸¬è©¦éŠæˆ²</button>
            <button class="test-button" onclick="testAction()">æ¸¬è©¦å‹•ä½œ</button>
            <button class="test-button" onclick="testValidate()">æ¸¬è©¦é©—è­‰</button>
            <button class="test-button" onclick="testEvaluate()">æ¸¬è©¦è©•ä¼°</button>
            <button class="test-button" onclick="testChecksum()">æ¸¬è©¦æ ¡é©—</button>
            <button class="test-button" onclick="testHealth()">å¥åº·æª¢æŸ¥</button>
            <button class="test-button" onclick="clearLog()">æ¸…é™¤æ—¥èªŒ</button>
        </div>
        
        <div class="api-log" id="apiLog">
            ç­‰å¾… API æ¸¬è©¦...
        </div>
        
        <div class="reels-container">
            <div class="reel" id="reel1">ğŸ</div>
            <div class="reel" id="reel2">ğŸŠ</div>
            <div class="reel" id="reel3">ğŸ‡</div>
        </div>
        
        <div class="controls">
            <div class="bet-selector">
                <label for="betAmount">é¸æ“‡ä¸‹æ³¨é‡‘é¡:</label>
                <select id="betAmount">
                    <option value="1">$1</option>
                    <option value="2">$2</option>
                    <option value="5" selected>$5</option>
                    <option value="10">$10</option>
                    <option value="20">$20</option>
                    <option value="50">$50</option>
                    <option value="100">$100</option>
                    <option value="200">$200</option>
                </select>
            </div>
            
            <button class="spin-button" id="spinButton" onclick="simulateSpin()">
                æ¨¡æ“¬æ—‹è½‰ (æ¸¬è©¦ç”¨)
            </button>
        </div>
        
        <div class="result-display" id="resultDisplay">
            æ­¡è¿ä¾†åˆ°è€è™æ©ŸéŠæˆ² API æ¸¬è©¦é é¢ï¼
        </div>
    </div>

    <script>
        const symbolMap = {
            'SYM1': 'ğŸ€',
            'SYM2': 'ğŸ',
            'SYM3': 'ğŸŠ',
            'SYM4': 'ğŸ‡',
            'SYM5': 'ğŸ“',
            'SYM6': 'ğŸ¥'
        };

        // å…¨åŸŸè®Šæ•¸
        let currentSessionId = null;
        let currentBalance = 0;
        let currentCurrency = 'EUR';
        let activeCheat = null; // ç•¶å‰å•Ÿç”¨çš„ä½œå¼Šç¢¼

        function log(message, addSeparator = false) {
            const apiLog = document.getElementById('apiLog');
            const timestamp = new Date().toLocaleTimeString();
            if (addSeparator) {
                apiLog.innerHTML += `\n${'='.repeat(80)}\n`;
            }
            apiLog.innerHTML += `[${timestamp}] ${message}\n`;
            apiLog.scrollTop = apiLog.scrollHeight;
        }

        function logSeparator(title = '') {
            const apiLog = document.getElementById('apiLog');
            if (title) {
                apiLog.innerHTML += `\n${'='.repeat(80)}\n[${title}]\n${'='.repeat(80)}\n`;
            } else {
                apiLog.innerHTML += `\n${'â”€'.repeat(80)}\n`;
            }
            apiLog.scrollTop = apiLog.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('apiLog').innerHTML = '';
        }
        
        async function makeHTTPRequest(endpoint, data) {
            try {
                log(`ç™¼é€è«‹æ±‚åˆ°: ${endpoint}`);
                log(`è«‹æ±‚è³‡æ–™: ${JSON.stringify(data, null, 2)}`);
                
                const response = await fetch(`http://localhost:8080/slot-game-provider/slot-game${endpoint}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                log(`å›æ‡‰ç‹€æ…‹: ${response.status} ${response.statusText}`);
                
                const responseText = await response.text();
                log(`åŸå§‹å›æ‡‰: ${responseText}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const jsonData = JSON.parse(responseText);
                log(`è§£æå¾Œçš„ JSON: ${JSON.stringify(jsonData, null, 2)}`);
                
                return jsonData;
                
            } catch (error) {
                log(`éŒ¯èª¤: ${error.message}`);
                throw error;
            }
        }
        
        async function testGames() {
            try {
                logSeparator('æ¸¬è©¦éŠæˆ²åˆ—è¡¨');
                const response = await fetch(`http://localhost:8080/api/games`, {
                    method: 'GET',
                });
                const result = await response.json();
                log(`éŠæˆ²åˆ—è¡¨ API å›æ‡‰: ${JSON.stringify(result, null, 2)}`);
                log('âœ… éŠæˆ²åˆ—è¡¨ API æ¸¬è©¦æˆåŠŸï¼');
            } catch (error) {
                log(`âŒ éŠæˆ²åˆ—è¡¨ API æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        async function testAuthenticate() {
            try {
                logSeparator('æ¸¬è©¦èªè­‰');
                document.getElementById('connectionStatus').textContent = 'â³ èªè­‰ä¸­...';
                document.getElementById('connectionStatus').className = 'connection-status connecting';

                const result = await makeHTTPRequest('/authenticate', {
                    operator: "demo",
                    wallet: "demo",
                    key: "test-player-123:1000:eur"
                });

                // å„²å­˜èªè­‰è³‡è¨Š
                currentSessionId = result.sessionId;
                currentBalance = result.balance;
                currentCurrency = result.currency;

                // æ›´æ–°ç•«é¢é¡¯ç¤º - éš±è—ç™»å…¥æç¤ºï¼Œé¡¯ç¤ºé¤˜é¡
                document.getElementById('loginPrompt').classList.add('hidden');
                document.getElementById('balanceDisplay').classList.remove('hidden');
                document.getElementById('balance').textContent = currentBalance;

                document.getElementById('connectionStatus').textContent = 'âœ… å·²ç™»å…¥';
                document.getElementById('connectionStatus').className = 'connection-status connected';
                log(`âœ… èªè­‰æ¸¬è©¦æˆåŠŸï¼SessionID: ${currentSessionId}, é¤˜é¡: ${currentBalance} ${currentCurrency}`);

            } catch (error) {
                document.getElementById('connectionStatus').textContent = 'âŒ èªè­‰å¤±æ•—';
                document.getElementById('connectionStatus').className = 'connection-status disconnected';
                log(`âŒ èªè­‰æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }
        
        async function testConfig() {
            try {
                logSeparator('æ¸¬è©¦é…ç½®');
                const response = await fetch(`http://localhost:8080/slot-game-provider/slot-game/config`, {
                    method: 'GET',
                });
                const result = await response.json();
                log(`é…ç½® API å›æ‡‰: ${JSON.stringify(result, null, 2)}`);
                log('âœ… é…ç½® API æ¸¬è©¦æˆåŠŸï¼');
            } catch (error) {
                log(`âŒ é…ç½® API æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        async function testBets() {
            try {
                logSeparator('æ¸¬è©¦ä¸‹æ³¨é…ç½®');
                const response = await fetch(`http://localhost:8080/slot-game-provider/slot-game/bets`, {
                    method: 'GET',
                });
                const result = await response.json();
                log(`ä¸‹æ³¨é…ç½® API å›æ‡‰: ${JSON.stringify(result, null, 2)}`);
                log('âœ… ä¸‹æ³¨é…ç½® API æ¸¬è©¦æˆåŠŸï¼');
            } catch (error) {
                log(`âŒ ä¸‹æ³¨é…ç½® API æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        async function testInfo() {
            try {
                logSeparator('æ¸¬è©¦è³‡è¨Š');
                // å…ˆç¢ºä¿å·²èªè­‰
                if (!currentSessionId) {
                    log('âš ï¸ éœ€è¦å…ˆèªè­‰ï¼Œè‡ªå‹•åŸ·è¡Œèªè­‰...');
                    await testAuthenticate();
                }

                const result = await makeHTTPRequest('/info', {
                    sessionId: currentSessionId
                });
                log('âœ… è³‡è¨Š API æ¸¬è©¦æˆåŠŸï¼');
                log(`éŠæˆ²è³‡è¨Š: ${JSON.stringify(result, null, 2)}`);
            } catch (error) {
                log(`âŒ è³‡è¨Š API æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        async function testCheats() {
            try {
                logSeparator('æ¸¬è©¦ä½œå¼Š');
                const response = await fetch(`http://localhost:8080/slot-game-provider/slot-game/cheats`, {
                    method: 'GET',
                });
                const result = await response.json();
                log(`ä½œå¼Š API å›æ‡‰: ${JSON.stringify(result, null, 2)}`);
                log('âœ… ä½œå¼Š API æ¸¬è©¦æˆåŠŸï¼');

                // å¾ªç’°åˆ‡æ›ä½œå¼Šç¢¼ï¼šbigWin â†’ superWin â†’ win â†’ null
                if (result.main && result.main.length > 0) {
                    if (!activeCheat) {
                        activeCheat = 'bigWin';  // ç¬¬ä¸€æ¬¡æŒ‰å°±è¨­ç‚º bigWinï¼Œæ–¹ä¾¿æ¸¬è©¦ bonus spin
                    } else if (activeCheat === 'bigWin') {
                        activeCheat = 'superWin';
                    } else if (activeCheat === 'superWin') {
                        activeCheat = 'win';
                    } else {
                        activeCheat = null;
                    }

                    if (activeCheat) {
                        let cheatDescription = {
                            'win': 'æ™®é€šä¸­ç (2x)',
                            'bigWin': 'BigWin (10x) + Bonus Spin',
                            'superWin': 'SuperWin (50x)'
                        };
                        log(`ğŸ¯ å·²å•Ÿç”¨ä½œå¼Šç¢¼: ${activeCheat} - ${cheatDescription[activeCheat]}`);
                        document.getElementById('gameStatus').textContent = `ğŸ¯ ä½œå¼Šæ¨¡å¼: ${activeCheat}`;
                    } else {
                        log(`ğŸ¯ ä½œå¼Šç¢¼å·²é—œé–‰ - æ¢å¾©æ­£å¸¸éš¨æ©Ÿæ¨¡å¼`);
                        document.getElementById('gameStatus').textContent = 'é é¢å·²è¼‰å…¥ï¼Œå¯ä»¥æ¸¬è©¦ API';
                    }
                }
            } catch (error) {
                log(`âŒ ä½œå¼Š API æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        async function testValidate() {
            try {
                logSeparator('æ¸¬è©¦é©—è­‰');
                const result = await makeHTTPRequest('/validate', {
                    action: "main",
                    bet: 10
                });
                log(`é©—è­‰çµæœ: ${result.valid ? 'æœ‰æ•ˆ' : 'ç„¡æ•ˆ'}`);
                log('âœ… é©—è­‰ API æ¸¬è©¦æˆåŠŸï¼');
            } catch (error) {
                log(`âŒ é©—è­‰ API æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        async function testHealth() {
            try {
                logSeparator('å¥åº·æª¢æŸ¥');
                const response = await fetch(`http://localhost:8080/health`, {
                    method: 'GET',
                });
                const result = await response.text();
                log(`å¥åº·æª¢æŸ¥å›æ‡‰: ${result}`);
                log('âœ… å¥åº·æª¢æŸ¥æ¸¬è©¦æˆåŠŸï¼');
            } catch (error) {
                log(`âŒ å¥åº·æª¢æŸ¥æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }
        
        async function testPlay() {
            try {
                logSeparator('æ¸¬è©¦éŠæˆ²');
                // å…ˆç¢ºä¿å·²èªè­‰
                if (!currentSessionId) {
                    log('âš ï¸ éœ€è¦å…ˆèªè­‰ï¼Œè‡ªå‹•åŸ·è¡Œèªè­‰...');
                    await testAuthenticate();
                }

                const betAmount = parseInt(document.getElementById('betAmount').value) || 5;
                const result = await makeHTTPRequest('/play', {
                    sessionId: currentSessionId,
                    action: "main",
                    bet: betAmount
                });

                log(`âœ… éŠæˆ² API æ¸¬è©¦æˆåŠŸï¼ä¸‹æ³¨: ${betAmount}, ç²å‹: ${result.wager.win}`);

                // é¡¯ç¤ºéŠæˆ²çµæœ
                if (result.wager && result.wager.data && result.wager.data.symbols) {
                    displaySymbols(result.wager.data.symbols);
                    const isWin = result.wager.data.isWin;
                    const winAmount = result.wager.win || 0;

                    if (isWin) {
                        log(`ğŸ‰ ä¸­çï¼ç¬¦è™Ÿ: [${result.wager.data.symbols.join(', ')}], ç²å¾—: ${winAmount}`);
                    } else {
                        log(`ğŸ˜¢ æ²’ä¸­çã€‚ç¬¦è™Ÿ: [${result.wager.data.symbols.join(', ')}]`);
                    }

                    // æ›´æ–°é¤˜é¡
                    document.getElementById('balance').textContent = result.balance;
                }

            } catch (error) {
                log(`âŒ éŠæˆ² API æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }
        
        function displaySymbols(symbols) {
            document.getElementById('reel1').textContent = symbolMap[symbols[0]] || symbols[0];
            document.getElementById('reel2').textContent = symbolMap[symbols[1]] || symbols[1];
            document.getElementById('reel3').textContent = symbolMap[symbols[2]] || symbols[2];
        }
        
        async function simulateSpin() {
            logSeparator('æ¨¡æ“¬æ—‹è½‰');
            const reels = ['reel1', 'reel2', 'reel3'];
            const symbols = Object.values(symbolMap);

            // æ·»åŠ æ—‹è½‰å‹•ç•«
            reels.forEach(reelId => {
                document.getElementById(reelId).classList.add('spinning');
            });

            document.getElementById('resultDisplay').textContent = 'æ—‹è½‰ä¸­...';
            document.getElementById('spinButton').disabled = true;

            try {
                // å…ˆç¢ºä¿å·²èªè­‰
                if (!currentSessionId) {
                    log('âš ï¸ éœ€è¦å…ˆèªè­‰ï¼Œè‡ªå‹•åŸ·è¡Œèªè­‰...');
                    await testAuthenticate();
                }

                // å‘¼å«å¾Œç«¯ /play API
                const betAmount = parseInt(document.getElementById('betAmount').value) || 5;
                const playRequest = {
                    sessionId: currentSessionId,
                    action: "main",
                    bet: betAmount
                };

                // å¦‚æœæœ‰å•Ÿç”¨ä½œå¼Šç¢¼ï¼ŒåŠ å…¥è«‹æ±‚ä¸­
                if (activeCheat) {
                    playRequest.cheat = activeCheat;
                    log(`ğŸ¯ ä½¿ç”¨ä½œå¼Šç¢¼: ${activeCheat}`);
                }

                const result = await makeHTTPRequest('/play', playRequest);

                log('ğŸ° é–‹å§‹æ—‹è½‰ï¼ä¸‹æ³¨é‡‘é¡: ' + betAmount);

                // ä½¿ç”¨å¾Œæ¸…é™¤ä½œå¼Šç¢¼ï¼ˆä¸€æ¬¡æ€§ä½¿ç”¨ï¼‰
                if (activeCheat) {
                    log(`ğŸ¯ ä½œå¼Šç¢¼å·²ä½¿ç”¨ä¸¦æ¸…é™¤`);
                    activeCheat = null;
                    document.getElementById('gameStatus').textContent = 'é é¢å·²è¼‰å…¥ï¼Œå¯ä»¥æ¸¬è©¦ API';
                }

                // 1ç§’å¾Œåœæ­¢ä¸¦é¡¯ç¤ºçœŸå¯¦çµæœ
                setTimeout(async () => {
                    // é¡¯ç¤ºå¾Œç«¯è¿”å›çš„ç¬¦è™Ÿ
                    if (result.wager && result.wager.data && result.wager.data.symbols) {
                        const serverSymbols = result.wager.data.symbols;
                        reels.forEach((reelId, index) => {
                            const reel = document.getElementById(reelId);
                            reel.textContent = symbolMap[serverSymbols[index]] || 'â“';
                            reel.classList.remove('spinning');
                        });

                        // é¡¯ç¤ºçµæœ
                        const isWin = result.wager.data.isWin;
                        const winAmount = result.wager.win || 0;
                        const winType = result.wager.data.winType;
                        let balance = result.balance;

                        if (isWin) {
                            let winMessage = `ğŸ‰ æ­å–œä¸­çï¼ç²å¾— ${winAmount} å…ƒï¼`;
                            if (winType === 'big_win') {
                                winMessage = `ğŸ† BigWinï¼ç²å¾— ${winAmount} å…ƒï¼æº–å‚™ Bonus Spin...`;
                            }
                            document.getElementById('resultDisplay').textContent = winMessage;
                            log(`âœ… ä¸­çï¼é¡å‹: ${winType}, ç¬¦è™Ÿ: [${serverSymbols.join(', ')}], ç²å¾—: ${winAmount}, é¤˜é¡: ${balance}`);
                        } else {
                            document.getElementById('resultDisplay').textContent =
                                `ğŸ˜¢ æ²’æœ‰ä¸­çï¼é¤˜é¡: ${balance}`;
                            log(`âŒ æ²’ä¸­çã€‚ç¬¦è™Ÿ: [${serverSymbols.join(', ')}], é¤˜é¡: ${balance}`);
                        }

                        // æ›´æ–°é¤˜é¡é¡¯ç¤º
                        document.getElementById('balance').textContent = balance;

                        // æª¢æŸ¥æ˜¯å¦æœ‰ next å‹•ä½œï¼ˆbigWin è§¸ç™¼ bonus_spinï¼‰
                        if (result.wager.next && result.wager.next.includes('bonus_spin')) {
                            log('ğŸ° è§¸ç™¼ Bonus Spinï¼ç­‰å¾… 2 ç§’å¾Œè‡ªå‹•æ—‹è½‰...');
                            document.getElementById('gameStatus').textContent = 'ğŸ† BigWin - Bonus Spin å³å°‡é–‹å§‹ï¼';

                            // 2ç§’å¾ŒåŸ·è¡Œ bonus spin
                            setTimeout(async () => {
                                try {
                                    // å†æ¬¡æ·»åŠ æ—‹è½‰å‹•ç•«
                                    reels.forEach(reelId => {
                                        document.getElementById(reelId).classList.add('spinning');
                                    });
                                    document.getElementById('resultDisplay').textContent = 'ğŸ° Bonus Spin æ—‹è½‰ä¸­...';

                                    // æ¨™æº– Tequity åšæ³•ï¼šå†æ¬¡èª¿ç”¨ /playï¼Œå‚³é action å’Œ roundId
                                    const bonusResult = await makeHTTPRequest('/play', {
                                        sessionId: currentSessionId,
                                        action: 'bonus_spin',
                                        roundId: result.roundId,
                                        bet: betAmount
                                    });

                                    log('ğŸ† Bonus Spin å®Œæˆï¼');

                                    // 1ç§’å¾Œé¡¯ç¤º bonus spin çµæœ
                                    setTimeout(() => {
                                        if (bonusResult.wager && bonusResult.wager.data) {
                                            const bonusSymbols = bonusResult.wager.data.symbols;
                                            reels.forEach((reelId, index) => {
                                                const reel = document.getElementById(reelId);
                                                reel.textContent = symbolMap[bonusSymbols[index]] || 'â“';
                                                reel.classList.remove('spinning');
                                            });

                                            const bonusWin = bonusResult.wager.win || 0;
                                            const bonusWinType = bonusResult.wager.data.winType;
                                            const totalWin = bonusResult.totalWin || (winAmount + bonusWin);
                                            balance = bonusResult.balance;

                                            if (bonusWinType === 'super_win') {
                                                document.getElementById('resultDisplay').textContent =
                                                    `ğŸ†ğŸ† SUPER WINï¼ï¼ï¼ç²å¾— ${bonusWin} å…ƒï¼ç¸½çé‡‘: ${totalWin} å…ƒï¼é¤˜é¡: ${balance}`;
                                                log(`ğŸ†ğŸ† SUPER WINï¼ç¬¦è™Ÿ: [${bonusSymbols.join(', ')}], Bonus çé‡‘: ${bonusWin}, ç¸½çé‡‘: ${totalWin}, æ–°é¤˜é¡: ${balance}`);
                                            } else if (bonusResult.wager.data.isWin) {
                                                document.getElementById('resultDisplay').textContent =
                                                    `ğŸ‰ Bonus Spin ä¸­çï¼ç²å¾— ${bonusWin} å…ƒï¼ç¸½çé‡‘: ${totalWin} å…ƒï¼é¤˜é¡: ${balance}`;
                                                log(`âœ… Bonus Spin ä¸­çï¼ç¬¦è™Ÿ: [${bonusSymbols.join(', ')}], çé‡‘: ${bonusWin}, ç¸½çé‡‘: ${totalWin}, æ–°é¤˜é¡: ${balance}`);
                                            } else {
                                                document.getElementById('resultDisplay').textContent =
                                                    `ğŸ˜¢ Bonus Spin æ²’ä¸­çã€‚ç¸½çé‡‘: ${totalWin} å…ƒï¼Œé¤˜é¡: ${balance}`;
                                                log(`âŒ Bonus Spin æ²’ä¸­çã€‚ç¬¦è™Ÿ: [${bonusSymbols.join(', ')}], ç¸½çé‡‘: ${totalWin}, é¤˜é¡: ${balance}`);
                                            }

                                            // æ›´æ–°é¤˜é¡é¡¯ç¤º
                                            document.getElementById('balance').textContent = balance;
                                            document.getElementById('gameStatus').textContent = 'é é¢å·²è¼‰å…¥ï¼Œå¯ä»¥æ¸¬è©¦ API';
                                        }
                                        document.getElementById('spinButton').disabled = false;
                                    }, 1000);

                                } catch (error) {
                                    log(`âŒ Bonus Spin å¤±æ•—: ${error.message}`);
                                    reels.forEach(reelId => {
                                        document.getElementById(reelId).classList.remove('spinning');
                                    });
                                    document.getElementById('spinButton').disabled = false;
                                }
                            }, 2000);
                        } else {
                            document.getElementById('spinButton').disabled = false;
                        }
                    } else {
                        document.getElementById('resultDisplay').textContent = 'âŒ API è¿”å›æ ¼å¼éŒ¯èª¤';
                        log(`âŒ API è¿”å›æ ¼å¼éŒ¯èª¤: ${JSON.stringify(result)}`);
                        document.getElementById('spinButton').disabled = false;
                    }
                }, 1000);

            } catch (error) {
                reels.forEach(reelId => {
                    document.getElementById(reelId).classList.remove('spinning');
                });
                document.getElementById('resultDisplay').textContent = 'âŒ API å‘¼å«å¤±æ•—';
                document.getElementById('spinButton').disabled = false;
                log(`âŒ æ—‹è½‰å¤±æ•—: ${error.message}`);
            }
        }
        
        async function testAction() {
            try {
                logSeparator('æ¸¬è©¦å‹•ä½œ');
                const result = await makeHTTPRequest('/action', {
                    next: ["main"],
                    config: {}
                });
                log('âœ… å‹•ä½œ API æ¸¬è©¦æˆåŠŸï¼');
            } catch (error) {
                log(`âŒ å‹•ä½œ API æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        async function testEvaluate() {
            try {
                logSeparator('æ¸¬è©¦è©•ä¼°');
                const result = await makeHTTPRequest('/evaluate', {
                    type: "regulatory-pt",
                    wagers: [{
                        data: {
                            symbols: ['SYM1', 'SYM2', 'SYM3']
                        },
                        win: 0,
                        bet: 5
                    }]
                });
                log('âœ… è©•ä¼° API æ¸¬è©¦æˆåŠŸï¼');
                log(`è©•ä¼°çµæœ: ${JSON.stringify(result, null, 2)}`);
            } catch (error) {
                log(`âŒ è©•ä¼° API æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        async function testChecksum() {
            try {
                logSeparator('æ¸¬è©¦æ ¡é©—');
                const response = await fetch('http://localhost:8080/criticalFileChecksum?criticalFilePath=games/slot-game/index.ts');
                const result = await response.json();
                log('âœ… æ ¡é©— API æ¸¬è©¦æˆåŠŸï¼');
                log(`æ ¡é©—ç¢¼: ${result.checksum}`);
            } catch (error) {
                log(`âŒ æ ¡é©— API æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        // é é¢è¼‰å…¥å®Œæˆ
        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸ® é é¢è¼‰å…¥å®Œæˆï¼Œå¯ä»¥é–‹å§‹æ¸¬è©¦ APIï¼');
            document.getElementById('gameStatus').textContent = 'é é¢å·²è¼‰å…¥ï¼Œå¯ä»¥æ¸¬è©¦ API';
        });
    </script>
</body>
</html>
